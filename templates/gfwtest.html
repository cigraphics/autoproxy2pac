{%extends "base.html"%}

{%block title1%}GFW Test{%endblock%}

{%block css_and_script%}
<style>
  #content {
    font-size: 14px;
    text-align: center;
  }
  #url-form {
    margin: 60px 0px 30px;
  }
  #url {
    font-size: 17px;
    width: 500px;
  }
  #url-form button {
    font-size: 15px;
    height: 26px;
  }
  #status a {
    margin: 0px 10px;
  }
  #example a {
    margin-left: 10px;
  }
</style>
{%endblock%}

{%block deferred_script%}
<script src="/gfwtest.js"></script>
<script>
  function testUrl() {
    var url = $('#url').val();
    if(!url) return;
    if(!/https?:\/\//.test(url)) { url = 'http://'+url; $('#url').val(url); }
    var s = $('#status').empty();
    s.append($(isBlockedByGFW(url)?'#prefetch .block':'#prefetch .pass').clone()).append('<br>');
    $('<a>访问</a>').attr('href',url).appendTo(s);
    $('<a>状态有误</a>').attr('href','https://jimmyxu.com/ap/?url='+url).appendTo(s);
    s.fadeIn();
  }
  $('#url-form').submit(function() {
    testUrl();
    var url = encodeURI($('#url').val()).replace(/%25/g,'%'); /* Fix Chinese characters for Safari */
    gfwtestLastHash = window.location.hash = '#'+url;
  });
  gfwtestLastHash = ''; setInterval(function() { if(window.location.hash != gfwtestLastHash) {
    gfwtestLastHash = window.location.hash;
    $('#url').val(decodeURI(window.location.hash.slice(1)));
    testUrl();
  }},100);
</script>
{%endblock%}

{%block tagline%}
查看网站是否撞墙
{%endblock%}

{%block content%}
<form id="url-form" onsubmit="return false">
  <input type="url" id="url" value="http://" autofocus onkeydown="if(event.keyCode!=13) {$('#status').fadeOut('slow');}">
  <button type="submit">测试</button>
</form>
<div style="height:200px;">
  <div id="status"></div>
  <div id="prefetch" style="display:none;">
    <img class="pass" src="{{media_url}}pass.png" width="150" height="150" alt="正常">
    <img class="block" src="{{media_url}}block.png" width="150" height="150" alt="撞墙">
  </div>
</div>
<p id="example">试试这些:
  <a href="#http://www.google.com/search?q=胡萝卜">Google</a>
  <a href="#http://www.facebook.com/">Facebook</a>
  <a href="#http://www.youtube.com/">YouTube</a>
  <a href="#http://twitter.com/">Twitter</a>
  <a href="#http://wikipedia.org/">Wikipedia</a>
  <a href="#http://www.blogger.com/">Blogger</a>
  <a href="#http://picasaweb.google.com/">Picasa</a>
</p>
{%endblock%}
